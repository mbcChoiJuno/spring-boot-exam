<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>mbc board (front)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container my-5">
  <h2 class="mb-4">게시글 상세보기</h2>

  <div class="border p-4 rounded shadow-sm bg-light">
    <h4 id="title" class="fw-bold mb-3">제목 로딩 중...</h4>

    <div class="mb-1">
      <span id="writerId" class="fw-semibold"></span>
    </div>

    <div class="text-muted small mb-4" id="metaBox">
      <!-- 날짜 및 조회수 -->
    </div>

    <div class="mb-5" id="content">
      <!-- 내용 -->
    </div>

    <div class="d-flex justify-content-end gap-2">
      <button class="btn btn-outline-secondary" onclick="goList()">목록</button>
      <button class="btn btn-outline-primary" onclick="goModify()">수정</button>
      <button class="btn btn-danger" onclick="deletePost()">삭제</button>
    </div>
  </div>
</div>

<script>
  const params = new URLSearchParams(location.search);
  const boardIndex = params.get("boardIndex");

  if (!boardIndex) {
    alert("잘못된 접근입니다.");
    location.href = "/board/list";
  }

  fetch(`http://192.168.0.171:6805/api/board/boards/${boardIndex}`)
          .then(res => res.json())
          .then(data => {
            const d = data.result.detail;

            if (d.deletedYn === "Y") {
              alert("삭제된 게시물입니다.");
              location.href = "/board/list";
              return;
            }

            document.getElementById("title").innerText = d.title;
            document.getElementById("content").innerText = d.content;
            document.getElementById("writerId").innerText = d.writerId;

            document.getElementById("metaBox").innerText =
                    `${formatDateTime(d.createDate)} · 조회 ${d.viewCount}`;

          });

  function formatDateTime(dateString) {
    const date = new Date(dateString);
    const yyyy = date.getFullYear();
    const mm = String(date.getMonth() + 1).padStart(2, '0');
    const dd = String(date.getDate()).padStart(2, '0');
    const hh = String(date.getHours()).padStart(2, '0');
    const mi = String(date.getMinutes()).padStart(2, '0');
    return `${yyyy}.${mm}.${dd}. ${hh}:${mi}`;
  }

  function goList() {
    location.href = "/board/list";

    /*if (document.referrer) {
      history.back();
    } else {
      location.href = "/";  // 직접 진입 등 referrer 없을 때 fallback
    }*/
  }

  function goModify() {
    location.href = `/board/modify?boardIndex=${boardIndex}`;
  }

  function deletePost() {
    if (!confirm("정말 삭제할까요?")) return;
    fetch(`http://192.168.0.171:6805/api/board/boards/${boardIndex}`, {
      method: "DELETE"
    }).then(() => location.href = "/board/list");
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
