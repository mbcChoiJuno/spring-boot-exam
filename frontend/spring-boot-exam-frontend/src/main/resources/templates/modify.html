<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>mbc board (front)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container my-5">
    <h2 class="mb-4">게시글 수정하기</h2>

    <form id="modifyForm" class="border p-4 rounded shadow-sm bg-light">
        <input type="hidden" id="boardIndex" />
        <div class="mb-3">
            <label for="title" class="form-label fw-bold">제목</label>
            <input type="text" id="title" class="form-control" required />
        </div>

        <div class="mb-3">
            <label for="content" class="form-label fw-bold">내용</label>
            <textarea id="content" rows="8" class="form-control" required></textarea>
        </div>

        <div class="d-flex justify-content-end gap-2">
            <button type="submit" class="btn btn-primary">수정</button>
            <button type="button" class="btn btn-outline-secondary" onclick="goBack()">취소</button>
        </div>
    </form>
</div>

<script>
    const params = new URLSearchParams(location.search);
    const boardIndex = params.get("boardIndex");

    if (!boardIndex) {
        alert("잘못된 접근입니다.");
        location.href = "/board/list";
    }

    fetch(`http://192.168.0.171:6805/api/board/boards/${boardIndex}`)
        .then(res => res.json())
        .then(data => {
            const d = data.result.detail;
            if (d.deletedYn === "Y") {
                alert("삭제된 게시물입니다.");
                location.href = "/board/list";
                return;
            }

            document.getElementById("boardIndex").value = d.boardIndex;
            document.getElementById("title").value = d.title;
            document.getElementById("content").value = d.content;
        });

    document.getElementById("modifyForm").addEventListener("submit", function (e) {
        e.preventDefault();

        const body = {
            boardIndex: parseInt(document.getElementById("boardIndex").value),
            title: document.getElementById("title").value,
            content: document.getElementById("content").value
        };

        fetch("http://192.168.0.171:6805/api/board/boards", {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body)
        }).then(() => location.href = `/board/read?boardIndex=${boardIndex}`);
    });

    function goBack() {
        history.back();
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
